#!/usr/bin/env ruby
$-w = true
require File.dirname(__FILE__)+"/../lib/all"

if ARGV.size != 3
  $stderr.puts "Usage: ProcessSources <PkgList> <Distro1> <Distro2>"
  exit 1
end

dist1 = ARGV[1]
dist2 = ARGV[2]

re = RuleEngine.new(dist1, dist2)

bins = File.new(ARGV[0]).map {|line| pkg, number = line.split; pkg}
re.process(bins)

$stderr.puts "Finished determining package matchups, #{re.errors} errors and #{re.warnings} warnings"
if re.errors > 0
  $stderr.puts "Aborting due to errors in package matchups, correct those to advance"
else
  $stderr.puts "Success!! Printing Matchups"
  re.matchups.each{|s1,s2| puts "#{s1 ? s1.to_s : 'nil'} #{s2 ? s2.to_s : 'nil'}"}
end
