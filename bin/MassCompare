#!/usr/bin/env ruby
# Take a package list and two ubuntu code names and generate the comparisons

$-w = true
require File.dirname(__FILE__)+"/../lib/all"

if ARGV.size != 3
  $stderr.puts "Usage: MassCompare <PkgList> <Distro1> <Distro2>"
  exit 1
end

dist1 = ARGV[1]
dist2 = ARGV[2]


sinfo1 = SourcesInfo.new(dist1)
sinfo2 = SourcesInfo.new(dist2)
re = RuleEngine.new(sinfo1, sinfo2)

bins = File.new(ARGV[0]).map {|line| pkg, number = line.split; pkg}
re.process(bins)

$stderr.puts "Finished determining package matchups, #{Util.errors} errors and #{Util.warnings} warnings"
if Util.errors > 0 || Util.warnings > 0
  $stderr.puts "Aborting due to errors or warnings in package matchups, correct those to advance"
  exit 1
end
$stderr.puts "Success!! Proceeding with comparison"

matchups = re.matchups
matchups.each_with_index do |match, i|
  s1, s2 = match 
  $stderr.puts "Comparison #{i+1}/#{matchups.size}: #{s1 ? s1 : "nil"} with #{s2 ? s2 : "nil"}"
  Comparator.compare(s1, s2, sinfo1, sinfo2)
end
